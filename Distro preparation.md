
Предыдущая статья: [[Setup plan]]

Начнем с дистрибутива. На самом деле, описанные в этом гайде инструкции можно выполнять практически на любом дистрибутиве linux. Я рекомендую Arch или любой другой Arch-based дистр, а лучше всего Artix, по одной простой причине - в этих дистрибутивах апстримное ПО, т.е. в отл от какого-нибудь Ubuntu/Debian вам не нужно ждать, пока ПО выйдет, его проверят, пропатчат, полностью поменяют формат и местоположение конфигов. Данный гайд построен на актуальной и оригинальной версии ПО (на момент написания), поэтому на downstream-дистрах у вас могут быть проблемы.

А еще apt-based дистры даже при минимальной установке тащат за собой кучу ненужных зависимостей которые потом надо чистить.

## Почему Artix?

Тут проблема в том, что systemd имеет такую неприятную вещь как socket activation (и еще кучу других непонятных вещей которые делают непонятно что и непонятно зачем, периодически что-то ломая), и будет за вас сама запускать dbus user session, pipewire, и еще что-нибудь... ломая всю концепцию гайда (мы хотим построить полностью supervised user tree процессов и управлять им). Конечно можно углубиться в недра systemd, отучить ее запускать то что не надо, но автор с 2021 года ушел на Artix и больше к systemd дистрам на личных устройствах не возвращался. И ни о чем не жалеет. Однако, данный гайд не требует, чтобы вы его придерживались в точности. Process supervision вы можете организовать с помощью systemd user services, разрешить ей запускать dbus/pipewire и другие сервисы когда ей самой нужно, сделать какое-то свое логгирование сервисов, или вообще не пилить супервижн и запускать по-старинке из баш-скрипта по типу

```bash
mango &
waybar &
other_background_app &
```

Но вы же сюда новое пришли изучать, так что имеет смысл хотя бы попробовать. В целом Artix это тот же Arch, но без systemd. На выбор дается openrc, runit, s6, и относительно новая dinit.
В этом гайде для управления процессами пользователя будет использоваться s6, Однако, в отличии от systemd и openrc, s6 можно запускать от имени обычного пользователя, сколько угодно раз, и даже имя другой инит в системе. То есть да, она может быть использована как pid 1, но это не обязательно (а для данного гайда вообще не нужно). s6 есть в официальных репозиториях artix, а так же в aur ([s6](https://aur.archlinux.org/packages/s6), [s6-rc](https://aur.archlinux.org/packages/s6-rc)) если у вас arch (установка s6 на арч НЕ сломает systemd и не будет с ней конфликтовать, не переживайте).

# Установка

В общем-то, вам нужен "голый" Arch или Artix. Во втором случае не имеет значения какой init выбираете, об этом было выше.

- Artix: https://wiki.artixlinux.org/Main/Installation (не забудьте [включить](https://wiki.artixlinux.org/Main/Repositories#Arch_repositories) репы арча)
- Arch: https://wiki.archlinux.org/title/Installation_guide

Просто следуйте инструкциям. Вам достаточно просто получить систему, которая может загружаться и иметь доступ в Интернет. Рекомендуемый список пакетов:
```bash
base base-devel neovim mkinitcpio dhcpcd dhcpcd-INITNAME
```

DHCPCD обеспечит автонастройку DHCP при подключении по ethernet. Если используете wifi, поставьте еще iwd. И если вы используйте иногда wifi, а иногда wired соединение, имеет смысл отключить настройку dhcp в iwd, чтобы dhcp в вашей системе занимался только dhcpcd:

`/etc/iwd/main.conf`
```
[General]
EnableNetworkConfiguration=false
```

NetworkManager слишком overhead для ADHDE, к тому же, но опять же - выбирать вам. Но в целом вам iwd должно хватить для "включил ноут, подключился к wifi, если сеть новая - ввёл пароль".

Еще мы будем часто ставить пакеты из AUR, так что рекомендую поставить какой-нибудь AUR helper, например yay.

Итак, если вы загрузили в систему, и:

1. Можете залогиниться хотя бы в tty обычным пользователем
2. sudo/doas работают ([или ssh на localhost через unix domain socket для эскалации привелегий](https://tim.siosm.fr/blog/2023/12/19/ssh-over-unix-socket/)) ([или вот еще один вариант с сокетами вместо suid](https://skarnet.org/software/s6/s6-sudod.html))
3. есть доступ в интернет (`nc -vz google.com 443`)

То вы готовы!

Следующая статья: [[GNU stow and dotfiles]]
