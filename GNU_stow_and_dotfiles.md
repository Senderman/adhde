
# Установка

Перед началом работы, установите git и stow:
```bash
pacman -S git stow
```

Так же убедитесь, что ваш /home находится на ФС, поддерживающей симлинки (ext4/xfs/btrfs/etc).

# GNU stow

Большая часть этой статьи вдохновлялась [другой статьей](https://alex.pearwin.com/2016/02/managing-dotfiles-with-stow). И если вам не лень, вы можете ее прочитать, и вы поймете как использовать stow для управления конфигами, а эту статью не читать. А если лень, то вам придется прочитать текст ниже :)

Т.к. в этом гайде мы установим и **настроим** кучу разношерстного ПО, то нам нужно:

1. Версионирование настроек, на случай если что-то сломали
2. Возможность их хранения на удаленном сервере и своевременное резервирование и восстановление

Понятно, что очевидное решение для версионирования это git, но проблема в том, что мы не можем сделать `git init` в `$HOME` по очевидным причинам.

Но мы можем сделать следующее:

1. Создать директорию `~/dotfiles` и хранить конфигурацию приложений в ней
2. Делать симлинки на эту директорию для конфигов. Например, `ln -s ~/dotfiles/zsh/.zshrc ~/.zshrc`

Здесь мы натыкаемся на следующую проблему: конфиги некоторого ПО могут быть разбросаны по разным путям. На каждый файл руками создавать симлинк это очень долго. Здесь нам как раз поможет stow

Как stow работает:

```bash
cd ~/dotfiles
stow zsh
readlink ~/.zshrc # ~/dotfiles/zsh/.zshrc
```

Для каждого файла внутри директории `zsh`, stow создает на него симлинк в директории выше CWD с таким же путём, как внутри zsh. При этом если директория по пути существует, то stow ее не тронет, а если не существует, то создаст симлинк. Более сложный пример:

```bash
$ file ~/.config # ~/.config: directory - директория ~/.config существует
$ tree -a mako

mako
└── .config
    └── mako
        └── config

$ stow mako

readlink ~/.config/mako # ~/dotfiles/mako/.config/mako
```

Т.к. директории `~/.config/mako` не существовало на момент запуска stow, (но существовала `~/.config`), то stow просто сделало `ln -s ~/dotfiles/mako/.config/mako ~/config/mako` вместо создания директорий и линкования файлов.

Итого:

1. Для каждого ПО или группы конфигов, создаем внутри `~/dotfiles` директорию `dir`
2. внутри `dir` кладём файлы по тем путям, как если бы они лежали в `$HOME`
3. возвращаемся в `~/dotfiles` и выполняем `stow dir`

В итоге вы получаете симлинки по путям, где приложение ожидает свои конфиг-файлы. И если вы попытаетесь отредактировать файл, например, через `nvim ~/.config/mako/config`, то на самом деле вы отредактируете файл в `~/dotfiles`

Теперь в директории `~/dotfiles` вы можете выполнить `git init` и управлять вашими конфигами как полноценным git-репозиторием!

Вот пример такого репозитория: https://github.com/Senderman/dotfiles

Для того чтобы удалить конфиги, просто выполните `stow -D dir` в директории `~/dotfiles`

